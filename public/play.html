// This script checks if the user has paid before showing the XNXX video
const urlParams = new URLSearchParams(window.location.search);
const videoId = urlParams.get('video');
const transactionId = urlParams.get('tid'); // The 'Token' from the payment gateway

if (transactionId) {
    // 1. Fetch the XNXX ID from your catalog.json based on videoId
    fetch('./src/database/catalog.json')
        .then(response => response.json())
        .then(data => {
            const video = data.find(v => v.id === videoId);
            
            // 2. Load the XNXX Embed only if transaction exists
            document.getElementById('player').innerHTML = `
                <div class="vip-status">PAYMENT VERIFIED: ACCESS GRANTED</div>
                <iframe src="https://www.xnxx.com/embedframe/${video.xnxx_id}" 
                        width="100%" height="500px" frameborder="0" allowfullscreen></iframe>
            `;
        });
} else {
    // 3. Kick them back to the payment page if no token
    window.location.href = "index.html?error=not_paid";
}
