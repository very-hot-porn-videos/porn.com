<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE VAULT | Private Screening</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #D4AF37; --bg: #000; }
        body { background-color: var(--bg); color: #fff; font-family: 'Inter', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        
        header { padding: 15px 5%; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; }
        .logo { color: var(--gold); font-weight: 900; letter-spacing: 2px; text-decoration: none; }

        .theater-container { flex: 1; display: flex; justify-content: center; align-items: center; padding: 20px; position: relative; }
        
        /* The Player Frame */
        #video-stage {
            width: 100%; max-width: 1100px; aspect-ratio: 16 / 9;
            background: #111; border: 1px solid #333; border-radius: 12px;
            box-shadow: 0 0 100px rgba(212, 175, 55, 0.1);
            overflow: hidden; display: flex; justify-content: center; align-items: center;
        }

        .loader-content { text-align: center; }
        .spinner { 
            width: 50px; height: 50px; border: 3px solid #333; border-top: 3px solid var(--gold); 
            border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .video-title-bar { padding: 20px 5%; background: #080808; border-top: 1px solid #111; }
        .back-link { color: #666; text-decoration: none; font-size: 0.9rem; transition: 0.3s; }
        .back-link:hover { color: var(--gold); }
    </style>
</head>
<body>

    <header>
        <a href="index.html" class="logo">THE VAULT</a>
        <div style="font-size: 0.7rem; color: var(--gold); border: 1px solid var(--gold); padding: 4px 10px; border-radius: 4px;">SECURE STREAM ACTIVE</div>
    </header>

    <main class="theater-container">
        <div id="video-stage">
            <div class="loader-content" id="loader">
                <div class="spinner"></div>
                <p id="status-text" style="color: #888; letter-spacing: 1px;">AUTHENTICATING ACCESS...</p>
            </div>
        </div>
    </main>

    <div class="video-title-bar">
        <h1 id="video-title" style="margin: 0 0 5px 0; font-size: 1.2rem;">Verifying Purchase...</h1>
        <a href="index.html" class="back-link">‚Üê Return to Catalog</a>
    </div>

    <script>
        /**
         * THE VAULT: SECURE PLAYBACK ENGINE
         */
        async function startCinema() {
            const params = new URLSearchParams(window.location.search);
            const vid = params.get('vid');   // Internal Video ID (e.g., v1)
            const tid = params.get('tid');   // Transaction ID from CCBill/Gateway

            const stage = document.getElementById('video-stage');
            const titleElement = document.getElementById('video-title');
            const statusText = document.getElementById('status-text');

            // 1. Check if they actually paid (basic URL check)
            if (!tid) {
                stage.innerHTML = `<div style="text-align:center; color:red;"><h2>ACCESS DENIED</h2><p>No valid transaction found. <a href="index.html" style="color:white;">Click here to buy.</a></p></div>`;
                return;
            }

            try {
                // 2. Load the catalog to find the hidden XNXX ID
                statusText.innerText = "UNLOCING VAULT CONTENT...";
                const response = await fetch('src/database/catalog.json');
                const catalog = await response.json();
                const video = catalog.find(v => v.id === vid);

                if (video) {
                    // 3. Inject the XNXX Player
                    titleElement.innerText = video.title;
                    stage.innerHTML = `
                        <iframe 
                            src="https://www.xnxx.com/embedframe/${video.xnxx_id}" 
                            width="100%" 
                            height="100%" 
                            frameborder="0" 
                            allowfullscreen="true" 
                            scrolling="no">
                        </iframe>`;
                } else {
                    throw new Error("Video Expired");
                }
            } catch (err) {
                stage.innerHTML = `<div style="text-align:center;"><h2>LINK EXPIRED</h2><p>Please contact support with ID: ${tid}</p></div>`;
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', startCinema);
    </script>
</body>
</html>
